# アイドリッシュセブン カードデータベース 要件定義書

## プロジェクト概要

### システム名
アイドリッシュセブン（IDOLiSH7）カードデータベース & スコア最適化ツール

### システムの目的
本システムは、スマートフォンゲーム「アイドリッシュセブン」のプレイヤー向けに、以下の機能を提供することを目的とする：
- ゲーム内カードの包括的なデータベース機能
- スコア最適化のための高度な検索・分析機能
- ブローチ情報の管理
- 楽曲情報の管理と表示機能

### 対象ユーザー
- アイドリッシュセブンのアクティブプレイヤー
- カード編成の最適化を行いたいユーザー
- ゲーム内イベントで高スコアを目指すユーザー
- 所有カードの管理を行いたいユーザー
- 所有ブローチの管理を行いたいユーザー

### システムの範囲
- カード情報の表示・検索・フィルタリング
- スコア計算ロジックの実装
- 楽曲情報の管理
- レスポンシブWebアプリケーション

### 機能要件

#### 楽曲データインポート機能
- **概要**: 楽曲情報のデータをインポートする
- **データソース**: 
  - https://docs.google.com/spreadsheets/d/1UxM2ekw7KlTTbCfPFMa6ihywrUMTryP5Zrv1DVEUKy4/edit?gid=1083871743#gid=1083871743
- **データ項目**: 
  - 基本情報（0-11）
    - ID - 楽曲ID
    - 分類 - 楽曲の分類（ŹOOĻ、IDOLiSH7など）
    - アーティスト名 - アーティスト名
    - 曲名 - 楽曲名
    - 楽曲種類 - 楽曲の種類（イベント楽曲など）
    - 難易度 - 難易度レベル（EXPERT+など）
    - ★ - 星評価
    - Shout割合 - Shout属性の割合（%）
    - Beat割合 - Beat属性の割合（%）
    - Melody割合 - Melody属性の割合（%）
    - ノーツ数 - 総ノーツ数
    - 秒数 - 楽曲の長さ（秒）
  - ノーツ詳細（12-59）
    - 各倍率（×1、×1.1、×1.2、×1.3、×1.5、×2.6、×3）ごとに、属性別（Shout/Beat/Melody）の白ノーツと色ノーツの数：
      - Shout×[倍率]白 - Shout属性の白ノーツ数
      - Shout×[倍率]色 - Shout属性の色ノーツ数
      - Beat×[倍率]白 - Beat属性の白ノーツ数
      - Beat×[倍率]色 - Beat属性の色ノーツ数
      - Melody×[倍率]白 - Melody属性の白ノーツ数
      - Melody×[倍率]色 - Melody属性の色ノーツ数
  - 合計（60-65）
    - Shout白合計 - Shout属性の白ノーツ合計
    - Shout色合計 - Shout属性の色ノーツ合計
    - Beat白合計 - Beat属性の白ノーツ合計
    - Beat色合計 - Beat属性の色ノーツ合計
    - Melody白合計 - Melody属性の白ノーツ合計
    - Melody色合計 - Melody属性の色ノーツ合計
- **補足事項**:　分類およびアーティストが空欄、もしくはノーツ数が0の楽曲はインポートの対象外とし，正規化は行わない。
- **データ更新**: 定期的にスプレッドシートからの更新を行う

#### 楽曲データインポート機能
- **概要**: 楽曲情報のデータをインポートする
- **データソース**: 
  - https://docs.google.com/spreadsheets/d/1UxM2ekw7KlTTbCfPFMa6ihywrUMTryP5Zrv1DVEUKy4/edit?gid=1083871743#gid=1083871743
- **データ項目**: 
  - カード基本情報（0-9）
    - ID - カードの一意識別子
    - cardID - カードID
    - cardname - カード名
    - name - キャラクター名
    - name_other - その他の名前情報
    - groupname - グループ名
    - rarity - レアリティ（UR/SSR/SR/R）
    - get_type - 入手方法
    - story - ストーリー情報
    - awakening_item - 覚醒アイテムID
  - ステータス情報（10-16）
    - attribute - 属性（1:Shout, 2:Beat, 3:Melody）
    - shout_min - Shout最小値
    - shout_max - Shout最大値
    - beat_min - Beat最小値
    - beat_max - Beat最大値
    - melody_min - Melody最小値
    - melody_max - Melody最大値
  - スキル情報（17-43）
    - APスキル基本情報
      - ap_skill_type - APスキルタイプ
      - ap_skill_req - APスキル発動条件
      - ap_skill_name - APスキル名
    - APスキルレベル別詳細（レベル1-5）
    - 各レベルごとに以下の4項目：
      - ap_skill_[1-5]_count - 発動回数
      - ap_skill_[1-5]_per - 発動確率（%）
      - ap_skill_[1-5]_value - 効果値
      - ap_skill_[1-5]_rate - 効果率
  - その他のスキル
    - ct_skill - センタースキル
    - comment - コメント
    - sp_time - SPスキル時間
    - sp_value - SPスキル値
- **補足事項**:　正規化は行わない。
- **データ更新**: 定期的にスプレッドシートからの更新を行う

#### 固有ブローチデータインポート機能
- **概要**: ブローチ情報のデータをインポートする。
- **データソース**: 
  - https://docs.google.com/spreadsheets/d/1UxM2ekw7KlTTbCfPFMa6ihywrUMTryP5Zrv1DVEUKy4/edit?gid=1087762308#gid=1087762308
- **データ項目**: 
  - グループカード基本情報（0-4）
    - ID - グループカードの一意識別子
    - cardID - 紐づくカードID
    - cardname - カード名
    - name - グループ名
    - name_other - メンバー情報
  - ステータス情報（5-7）
    - Shout - Shout属性値
    - Beat - Beat属性値
    - Melody - Melody属性値
  - 属性・グループ情報（8-10）
    - 属性 - カードの属性（数値）
    - アイドル - アイドルタイプ
    - グループ - グループタイプ
  - スコア関連情報（11-14）
    - オート - オートスコア値
    - 楽曲 - 楽曲スコア値
    - スコア - 総合スコア値
    - 上限 - スコア上限値
  - ブローチ情報（15）
    - ブローチの種類 - ブローチのタイプ
- **補足事項**:　正規化は行わない。
- **データ更新**: 定期的にスプレッドシートからの更新を行う

### カード管理機能

#### カード一覧表示
- **概要**: 全カードの一覧表示
- **詳細要件**:
  - ページネーション（100件/ページ）
  - カード画像のサムネイル表示
  - 基本情報（ID、レアリティ、属性、ステータス、スキル）の表示
  - カード詳細へのリンク

#### カード検索機能
- **概要**: 複数条件でのカード検索
- **検索条件**:
  - カード名/キャラクター名（部分一致）
  - レアリティ（UR/SSR/SR/R/GROUP）
  - 属性（Shout/Beat/Melody）
  - キャラクター（17キャラクター）
  - スキルタイプ

#### カード詳細表示
- **概要**: 個別カードの詳細情報表示
- **表示項目**:
  - カード画像（フルサイズ）
  - 基本情報（名前、レアリティ、入手方法）
  - ステータス（Shout/Beat/Melody の最小/最大値）
  - スキル情報（APスキル、CTスキル、SPスキル）
  - スキルレベル別効果
  - リリース情報（実装日、イベント情報）
  - ブローチ情報

### スコア最適化機能

#### 高度な分析機能
- **概要**: スコア最適化のための詳細検索
- **検索条件**:
  - 基本検索条件（カード検索と同様）
  - スキル発動タイプ（タイマー/パーフェクト/コンボ）
  - イベントボーナス有無
  - 実装年
  - 衣装名
- **補足資料**: ./game_rule.md

#### 所有カード登録機能
- **概要**: 所有カード（ブラウザローカルストレージ使用）

#### ソート機能
- **概要**: 検索結果の並び替え
- **ソート条件**:
  - スコア効率順
  - 実装日順
  - ステータス合計値順

### 楽曲管理機能

#### 楽曲一覧
- **概要**: ゲーム内楽曲の一覧を表形式で表示
- **表示項目**:
  - 楽曲名
  - アーティスト
  - ノーツ数
  - 楽曲時間（秒）
  - 属性比率（Shout/Beat/Melody）の円グラフ

## 非機能要件

### 性能要件
- **レスポンスタイム**: 
  - ページロード: 3秒以内
  - 検索処理: 2秒以内
- **同時接続数**: 100ユーザー以上
- **データ容量**: カード画像含め10GB以上対応

### セキュリティ要件
- **通信**: HTTPS必須
- **データ保護**: SQLインジェクション対策
- **アクセス制御**: 読み取り専用（ユーザー認証なし）

### ユーザビリティ要件
- **対応デバイス**: PC、タブレット、スマートフォン
- **対応ブラウザ**: Chrome、Firefox、Safari、Edge（最新版）
- **レスポンシブデザイン**: Tailwind CSS使用
- **多言語対応**: 日本語のみ

### 保守性要件
- **コード品質**: TypeScript使用による型安全性
- **ドキュメント**: コード内コメント、API仕様書
- **テスト**: 単体テスト（Vitest）
- **デプロイ**: DockerコンテナでRenderにデプロイ

## データベース設計

### データベース構成
- **DBMS**: PostgreSQL 16
- **スキーマ**: i7_db

## 画面設計

### 画面構成

#### ホーム画面（/）
- ウェルカムメッセージ
- 主要機能へのリンク
- レアリティ別カード統計

#### カード一覧画面（/cards）
- 検索フォーム
- ページネーション
- カード表形式で表示

#### カード詳細画面（/card/[id]）
- カード画像（大）
- 詳細情報タブ
- スキルレベル表

#### スコアアップ検索画面（/scoreup）
- 詳細検索フォーム
- 検索結果一覧
- お気に入り管理

#### 楽曲一覧画面（/songs）
- 楽曲リスト
- 楽曲名
- アーティスト名
- ノーツ数
- 楽曲時間(秒)
- 属性比率円グラフ

### レイアウト設計
- **ヘッダー**: ナビゲーションメニュー（固定）
- **メインコンテンツ**: レスポンシブグリッド
- **フッター**: なし（シンプル設計）

## システム構成

### 技術スタック
- **フロントエンド**: SvelteKit + TypeScript
- **バックエンド**: SvelteKit（SSR）
- **データベース**: PostgreSQL 16
- **ORM**: Drizzle ORM
- **スタイリング**: Tailwind CSS
- **コンテナ**: Docker
- **テスト**: Vitest

### システムアーキテクチャ
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Client    │────▶│  SvelteKit  │────▶│ PostgreSQL  │
│  (Browser)  │     │   Server    │     │  Database   │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   Static    │
                    │   Assets    │
                    └─────────────┘
```

### API設計
- **GET /api/cards**: カード一覧取得
- **GET /api/cards/[id]**: カード詳細取得
- **GET /api/songs**: 楽曲一覧取得
- **GET /api/search**: 詳細検索

## 開発・運用要件

### 開発環境
- Node.js 18以上
- Docker Desktop
- VS Code推奨

### デプロイメント
- **本番環境**: Render (Webアプリ) + Neon (データベース)
- **開発環境**: Docker Compose

## 制約事項

### 技術的制約
- ユーザー認証機能なし（公開データベース）
- リアルタイムデータ更新なし（バッチ更新）
- 開発時はdocker compose  up -d で必ず起動できること

### ライセンス・法的制約
- ゲーム内画像の使用許諾範囲内での運用
- 営利目的での使用禁止

### 運用制約
- データ更新は自動実行（1日4回）
- 画像アップロードは管理者のみ

## 今後の拡張計画

### 機能拡張
- チーム編成シミュレーター
- スコア計算機能
- イベント情報連携
- ユーザー投稿型レビュー

### データ拡張
- 過去イベント情報
- ガチャ確率情報
- カード相性情報
